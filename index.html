<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>HealthTracker Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-blue: #4BA4F2;
            --secondary-blue: #5CB9F2;
            --light-bg: #DCEAF2;
            --accent-green: #04D94F;
            --accent-yellow: #F2B705;
            --text-dark: #2C3E50;
        }

        /* [Bestehende CSS-Stile hier einfÃ¼gen] */

        .swipe-container {
            position: relative;
            overflow: hidden;
        }

        .swipe-content {
            transition: transform 0.3s;
        }

        .delete-btn {
            position: absolute;
            right: -80px;
            width: 80px;
            height: 100%;
            background: #ff4444;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: right 0.3s;
        }

        .day-section {
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 15px;
        }

        .edit-btn {
            background: var(--accent-yellow);
            color: var(--text-dark);
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- [Bestehende HTML-Struktur hier einfÃ¼gen] -->
    <div class="section">
        <button onclick="exportPDF()" style="margin-top:20px;">ðŸ“„ PDF Export</button>
    </div>

    <script>
        // [Bestehende JavaScript-Funktionen hier einfÃ¼gen]

        // Neue Funktionen
        function setupSwipe() {
            let startX;
            document.querySelectorAll('.swipe-container').forEach(container => {
                let isDelete = false;
                
                container.addEventListener('touchstart', e => {
                    startX = e.touches[0].clientX;
                });

                container.addEventListener('touchmove', e => {
                    if (!startX) return;
                    const diff = e.touches[0].clientX - startX;
                    if (diff < -50 && !isDelete) {
                        container.querySelector('.delete-btn').style.right = '0';
                        isDelete = true;
                    }
                });

                container.addEventListener('touchend', () => {
                    startX = null;
                    if (isDelete) {
                        setTimeout(() => {
                            const id = container.dataset.id;
                            if (container.classList.contains('med-entry')) {
                                medicationHistory = medicationHistory.filter(e => e.id != id);
                                localStorage.setItem('medicationHistory', JSON.stringify(medicationHistory));
                            } else {
                                symptoms = symptoms.filter(e => e.id != id);
                                localStorage.setItem('symptoms', JSON.stringify(symptoms));
                            }
                            updateViews();
                        }, 300);
                    }
                    isDelete = false;
                });
            });
        }

        function editEntry(type, id) {
            const entry = type === 'med' 
                ? medicationHistory.find(e => e.id === id)
                : symptoms.find(e => e.id === id);

            const newVal = prompt('Bearbeiten:', type === 'med' 
                ? `${entry.med} | ${entry.dose}`
                : entry.desc);
            
            if (newVal) {
                if (type === 'med') {
                    const [med, dose] = newVal.split('|');
                    entry.med = med.trim();
                    entry.dose = dose.trim();
                } else {
                    entry.desc = newVal;
                }
                localStorage.setItem(type === 'med' ? 'medicationHistory' : 'symptoms', 
                    JSON.stringify(type === 'med' ? medicationHistory : symptoms));
                updateViews();
            }
        }

        function exportPDF() {
            const doc = new jspdf.jsPDF();
            let yPos = 20;

            // Medikationshistorie
            doc.setFontSize(16);
            doc.text('Medikationsprotokoll', 20, yPos);
            yPos += 15;
            
            medicationHistory.forEach(entry => {
                doc.setFontSize(12);
                doc.text(`${new Date(entry.time).toLocaleDateString('de-DE')} - ${entry.med}: ${entry.dose}`, 20, yPos);
                yPos += 10;
            });

            // Symptome
            yPos += 10;
            doc.setFontSize(16);
            doc.text('Symptomverlauf', 20, yPos);
            yPos += 15;
            
            symptoms.forEach(entry => {
                doc.setFontSize(12);
                doc.text(`${new Date(entry.time).toLocaleDateString('de-DE')}: ${entry.desc}`, 20, yPos);
                yPos += 10;
            });

            doc.save('Gesundheitsprotokoll.pdf');
        }

        // Update der Anzeigefunktionen
        function updateMedHistory() {
            const historyDiv = document.getElementById('medicationHistory');
            historyDiv.innerHTML = medicationHistory.map(entry => `
                <div class="swipe-container med-entry" data-id="${entry.id}">
                    <div class="swipe-content">
                        <div class="medication-entry">
                            <strong>${entry.med}</strong>
                            <button class="edit-btn" onclick="editEntry('med', '${entry.id}')">âœŽ</button>
                            <br>${entry.dose} um ${new Date(entry.time).toLocaleTimeString('de-DE')}
                            <span class="timestamp">NÃ¤chste Gabe: ${new Date(entry.nextDose).toLocaleString('de-DE')}</span>
                        </div>
                    </div>
                    <div class="delete-btn">LÃ¶schen</div>
                </div>
            `).join('');
            setupSwipe();
        }

        function updateSymptoms() {
            const list = document.getElementById('symptomsList');
            list.innerHTML = symptoms.map(s => `
                <div class="swipe-container" data-id="${s.id}">
                    <div class="swipe-content">
                        <div class="symptom-entry">
                            <strong>${new Date(s.time).toLocaleString('de-DE')}</strong>
                            <button class="edit-btn" onclick="editEntry('symptom', '${s.id}')">âœŽ</button>
                            <br>${s.desc}
                        </div>
                    </div>
                    <div class="delete-btn">LÃ¶schen</div>
                </div>
            `).join('');
            setupSwipe();
        }

        // Initialisierung mit IDs
        document.addEventListener('DOMContentLoaded', () => {
            medicationHistory = medicationHistory.map(e => ({...e, id: e.id || Date.now().toString()}));
            symptoms = symptoms.map(e => ({...e, id: e.id || Date.now().toString()}));
            updateViews();
        });
    </script>
</body>
</html>